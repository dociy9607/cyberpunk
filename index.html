<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kernel Space | 产品内核</title>
  <link rel="icon" type="image/png" href="./corn_favicon.png">
  <!-- Google Fonts - Orbitron (国内可访问镜像) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <!-- React, ReactDOM UMD - jsdelivr 国内加速 -->
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <!-- Babel 用于 JSX 转换 -->
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.0/babel.min.js"></script>
  <!-- canvas-confetti 烟花效果 -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      overflow: hidden;
      font-family: 'Orbitron', 'Microsoft YaHei', sans-serif;
      background: #0a0a0f;
    }

    /* 动态流动渐变背景 */
    .cyber-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -2;
      background: 
        linear-gradient(135deg, #0a0a0f 0%, #1a0a2e 25%, #0f0a1a 50%, #0a1a2e 75%, #0a0a0f 100%);
      background-size: 400% 400%;
      animation: gradientFlow 15s ease infinite;
    }

    /* 粒子网格背景 */
    .grid-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-image: 
        linear-gradient(rgba(176, 38, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(176, 38, 255, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridPulse 4s ease-in-out infinite;
    }

    @keyframes gradientFlow {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    @keyframes gridPulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }

    /* 倒计时容器 */
    .countdown-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 2rem;
    }

    /* 倒计时数字 - 巨大 + 霓虹发光 */
    .countdown-digits {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
    }

    .digit-block {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 0 0.25rem;
      animation: digitBounce 0.6s ease-in-out infinite;
    }

    .digit-block:nth-child(1) { animation-delay: 0s; }
    .digit-block:nth-child(2) { animation-delay: 0.05s; }
    .digit-block:nth-child(3) { animation-delay: 0.1s; }
    .digit-block:nth-child(4) { animation-delay: 0.15s; }
    .digit-block:nth-child(5) { animation-delay: 0.2s; }
    .digit-block:nth-child(6) { animation-delay: 0.25s; }
    .digit-block:nth-child(7) { animation-delay: 0.3s; }
    .digit-block:nth-child(8) { animation-delay: 0.35s; }
    .digit-block:nth-child(9) { animation-delay: 0.4s; }
    .digit-block:nth-child(10) { animation-delay: 0.1s; }
    .digit-block:nth-child(11) { animation-delay: 0.15s; }
    .digit-block:nth-child(12) { animation-delay: 0.2s; }
    .digit-block:nth-child(13) { animation-delay: 0.25s; }
    .digit-block:nth-child(14) { animation-delay: 0.3s; }
    .digit-block:nth-child(15) { animation-delay: 0.35s; }
    .digit-block:nth-child(16) { animation-delay: 0.4s; }
    .digit-block:nth-child(17) { animation-delay: 0.45s; }
    .digit-block:nth-child(18) { animation-delay: 0.5s; }

    @keyframes digitBounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.08); }
    }

    .digit {
      font-size: clamp(4rem, 15vw, 12rem);
      font-weight: 900;
      color: #fff;
      text-shadow: 
        0 0 4px currentColor,
        0 0 8px currentColor,
        0 0 12px rgba(255, 255, 255, 0.4);
      line-height: 1;
      animation: digitPulse 1s ease-in-out infinite;
      position: relative;
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.3));
    }

    .digit-block:nth-child(odd) .digit { color: #ff00ff; }
    .digit-block:nth-child(3n) .digit { color: #00ffff; }
    .digit-block:nth-child(3n+2) .digit { color: #ff0066; }

    @keyframes digitPulse {
      0%, 100% { 
        transform: scale(1); 
        text-shadow: 0 0 4px currentColor, 0 0 8px currentColor, 0 0 12px rgba(255,255,255,0.3);
      }
      50% { 
        transform: scale(1.05); 
        text-shadow: 0 0 6px currentColor, 0 0 12px currentColor, 0 0 18px rgba(255,255,255,0.4);
      }
    }

    /* 倒影效果 */
    .digit-reflection {
      font-size: inherit;
      font-weight: 900;
      color: rgba(255, 255, 255, 0.15);
      transform: scaleY(-1);
      margin-top: -0.1em;
      filter: blur(2px);
      animation: none !important;
      -webkit-mask-image: linear-gradient(to bottom, transparent, rgba(0,0,0,0.5));
      mask-image: linear-gradient(to bottom, transparent, rgba(0,0,0,0.5));
    }

    /* 分隔符 */
    .separator {
      font-size: clamp(3rem, 12vw, 10rem);
      font-weight: 900;
      color: #00ffff;
      text-shadow: 0 0 6px #00ffff, 0 0 12px rgba(0, 255, 255, 0.5);
      animation: blink 1s step-end infinite;
      margin: 0 0.1em;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0.3; }
    }

    /* 故障效果 (Glitch) */
    .glitch {
      position: relative;
    }

    .glitch::before,
    .glitch::after {
      content: attr(data-text);
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    .glitch::before {
      left: 2px;
      text-shadow: -2px 0 #ff00ff;
      clip-path: inset(40% 0 50% 0);
      animation: glitchAnim1 2s infinite linear alternate-reverse;
    }

    .glitch::after {
      left: -2px;
      text-shadow: 2px 0 #00ffff;
      clip-path: inset(60% 0 30% 0);
      animation: glitchAnim2 3s infinite linear alternate-reverse;
    }

    @keyframes glitchAnim1 {
      0% { clip-path: inset(40% 0 50% 0); transform: translate(-2px, 2px); }
      20% { clip-path: inset(10% 0 80% 0); transform: translate(2px, -2px); }
      40% { clip-path: inset(70% 0 20% 0); transform: translate(-2px, 2px); }
      60% { clip-path: inset(30% 0 60% 0); transform: translate(2px, -2px); }
      80% { clip-path: inset(80% 0 10% 0); transform: translate(-2px, 2px); }
      100% { clip-path: inset(40% 0 50% 0); transform: translate(2px, -2px); }
    }

    @keyframes glitchAnim2 {
      0% { clip-path: inset(60% 0 30% 0); transform: translate(2px, -2px); }
      20% { clip-path: inset(80% 0 10% 0); transform: translate(-2px, 2px); }
      40% { clip-path: inset(20% 0 70% 0); transform: translate(2px, -2px); }
      60% { clip-path: inset(50% 0 40% 0); transform: translate(-2px, 2px); }
      80% { clip-path: inset(10% 0 80% 0); transform: translate(2px, -2px); }
      100% { clip-path: inset(60% 0 30% 0); transform: translate(-2px, -2px); }
    }

    /* FREEDOM 文字 - 弹簧入场动画 (替代 Framer Motion) */
    .freedom-text {
      font-size: clamp(3rem, 10vw, 8rem);
      font-weight: 900;
      text-align: center;
      line-height: 1.2;
      position: relative;
      z-index: 10;
      animation: freedomScaleIn 0.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
    }

    @keyframes freedomScaleIn {
      0% { transform: scale(0); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    .freedom-text .line1 {
      color: #ff00ff;
      text-shadow: 
        0 0 10px #ff00ff,
        0 0 20px #ff00ff,
        0 0 40px #ff00ff,
        0 0 80px #ff00ff;
      animation: freedomGlow 2s ease-in-out infinite;
    }

    .freedom-text .line2 {
      color: #00ffff;
      font-size: 0.8em;
      margin-top: 0.2em;
      text-shadow: 
        0 0 10px #00ffff,
        0 0 20px #00ffff,
        0 0 40px #00ffff;
      animation: freedomGlow 2s ease-in-out infinite 0.5s;
    }

    @keyframes freedomGlow {
      0%, 100% { filter: brightness(1); opacity: 1; }
      50% { filter: brightness(1.3); opacity: 0.95; }
    }

    /* 副标题 */
    .subtitle {
      font-size: clamp(1rem, 3vw, 1.5rem);
      color: rgba(255, 255, 255, 0.7);
      margin-top: 2rem;
      letter-spacing: 0.3em;
      text-shadow: 0 0 10px rgba(176, 38, 255, 0.5);
    }

    /* 目标时间提示 */
    .target-hint {
      font-size: clamp(0.8rem, 2vw, 1rem);
      color: rgba(255, 255, 255, 0.5);
      margin-top: 1.5rem;
      letter-spacing: 0.2em;
    }

    /* 计分板 - 赛博风格 */
    .score-board {
      position: fixed;
      top: 20px;
      right: 24px;
      z-index: 20;
      font-family: 'Orbitron', monospace;
      font-size: 0.9rem;
      font-weight: 700;
      color: #00ffff;
      letter-spacing: 0.15em;
      text-shadow: 0 0 8px #00ffff, 0 0 16px rgba(0, 255, 255, 0.5);
      padding: 8px 16px;
      background: rgba(0, 0, 0, 0.5);
      border: 1px solid rgba(0, 255, 255, 0.4);
      border-radius: 4px;
    }
    .score-board .score-num {
      display: inline-block;
      min-width: 2em;
      text-align: right;
    }
    .score-board.score-bump .score-num {
      animation: scoreBump 0.3s ease-out;
    }
    @keyframes scoreBump {
      0% { transform: scale(1); }
      40% { transform: scale(1.25); }
      70% { transform: scale(0.95); }
      100% { transform: scale(1); }
    }
    /* LEVEL UP 弹窗 */
    .level-up-popup {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 100;
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      color: #ffd700;
      text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 80px #ffd700;
      animation: levelUpPop 1.5s ease-out forwards;
      pointer-events: none;
    }
    @keyframes levelUpPop {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
      40% { transform: translate(-50%, -50%) scale(1); }
      80% { opacity: 1; }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(1.1); }
    }
    /* 赛博豆子 - 捡豆子游戏 */
    .bean-layer {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }
    .bean-layer > * {
      pointer-events: auto;
    }
    .cyber-bean {
      position: absolute;
      width: 10px;
      height: 10px;
      border-radius: 2px;
      cursor: pointer;
      box-shadow: 0 0 6px currentColor, 0 0 12px currentColor;
    }
    /* 等级1: 绿色数据点 (0-49) */
    .cyber-bean.tier-green {
      background: #39ff14;
      color: #39ff14;
      animation: beanBreathe 2s ease-in-out infinite;
    }
    .cyber-bean.tier-green.yellow {
      background: #c9f031;
      color: #c9f031;
    }
    /* 等级2: 紫色能量块 (50-99) */
    .cyber-bean.tier-purple {
      background: #b026ff;
      color: #b026ff;
      width: 12px;
      height: 12px;
      border-radius: 3px;
      box-shadow: 0 0 12px #b026ff, 0 0 24px rgba(176, 38, 255, 0.8);
      animation: beanRotate 3s linear infinite;
    }
    /* 等级3: 金色核心 (100+) */
    .cyber-bean.tier-gold {
      background: #ffd700;
      color: #ffd700;
      width: 14px;
      height: 14px;
      border-radius: 4px;
      box-shadow: 0 0 16px #ffd700, 0 0 32px #ffd700, 0 0 48px rgba(255, 215, 0, 0.6);
      animation: beanCoreBreathe 1.5s ease-in-out infinite;
    }
    @keyframes beanBreathe {
      0%, 100% { opacity: 0.9; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }
    @keyframes beanRotate {
      from { transform: rotate(0deg); }
      to { transform: rotate(360deg); }
    }
    @keyframes beanCoreBreathe {
      0%, 100% { opacity: 1; transform: scale(1); box-shadow: 0 0 16px #ffd700, 0 0 32px #ffd700; }
      50% { opacity: 1; transform: scale(1.3); box-shadow: 0 0 24px #ffd700, 0 0 48px #ffd700, 0 0 64px rgba(255,215,0,0.5); }
    }
    .trail-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 3;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="react">
    (function() {
      const React = window.React;
      const ReactDOM = window.ReactDOM;
      const { useState, useEffect, useRef } = React;

      const TARGET_TIME = new Date('2026-02-13T12:30:00');

      let beanIdCounter = 0;
      function genSingleBean() {
        const margin = 80;
        return {
          id: beanIdCounter++,
          x: margin + Math.random() * (window.innerWidth - 2 * margin),
          y: margin + Math.random() * (window.innerHeight - 2 * margin),
          color: Math.random() > 0.5 ? 'yellow' : 'green'
        };
      }
      function genBeans() {
        const beans = [];
        for (let i = 0; i < 20; i++) beans.push(genSingleBean());
        return beans;
      }
      function getBeanTier(collected) {
        if (collected >= 100) return 'gold';
        if (collected >= 50) return 'purple';
        return 'green';
      }

      function useCountdown() {
        const [timeLeft, setTimeLeft] = useState(null);
        const [isReached, setIsReached] = useState(false);

        useEffect(() => {
          const tick = () => {
            const now = new Date();
            const diff = TARGET_TIME - now;

            if (diff <= 0) {
              setIsReached(true);
              setTimeLeft({ hours: 0, minutes: 0, seconds: 0 });
              return;
            }

            const hours = Math.floor(diff / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);

            setTimeLeft({ hours, minutes, seconds });
          };

          tick();
          const timer = setInterval(tick, 1000);
          return () => clearInterval(timer);
        }, []);

        return { timeLeft, isReached };
      }

      function useFireworks(active) {
        useEffect(() => {
          if (!active || typeof confetti !== 'function') return;

          const colors = ['#ff00ff', '#00ffff', '#ff0066', '#ffff00'];
          let animationId;

          const fire = () => {
            confetti({
              particleCount: 50,
              spread: 100,
              origin: { x: Math.random(), y: Math.random() },
              colors: colors,
            });
            confetti({
              particleCount: 30,
              angle: 60,
              spread: 55,
              origin: { x: 0 },
              colors: colors,
            });
            confetti({
              particleCount: 30,
              angle: 120,
              spread: 55,
              origin: { x: 1 },
              colors: colors,
            });
          };

          const loop = () => {
            fire();
            animationId = setTimeout(loop, 800);
          };
          loop();

          return () => clearTimeout(animationId);
        }, [active]);
      }

      function formatNum(n) {
        return String(n).padStart(2, '0');
      }

      function CountdownDisplay({ timeLeft }) {
        if (!timeLeft) return null;
        const { hours, minutes, seconds } = timeLeft;
        const digits = [
          ...formatNum(hours).split(''),
          ':',
          ...formatNum(minutes).split(''),
          ':',
          ...formatNum(seconds).split(''),
        ];

        return (
          <div className="countdown-digits">
            {digits.map((d, i) => 
              d === ':' 
                ? <span key={i} className="separator">:</span>
                : (
                    <div key={i} className="digit-block">
                      <span className="digit glitch" data-text={d}>{d}</span>
                      <span className="digit digit-reflection">{d}</span>
                    </div>
                  )
            )}
          </div>
        );
      }

      function FreedomDisplay() {
        return (
          <div className="freedom-text">
            <div className="line1 glitch" data-text="FREEDOM!">FREEDOM!</div>
            <div className="line2 glitch" data-text="放假啦！">放假啦！</div>
          </div>
        );
      }

      function BeanGame() {
        const [beans, setBeans] = useState(() => genBeans());
        const [collectedCount, setCollectedCount] = useState(0);
        const [showLevelUp, setShowLevelUp] = useState(false);
        const [scoreBump, setScoreBump] = useState(false);
        const trailRef = useRef([]);
        const mouseRef = useRef({ x: 0, y: 0 });
        const canvasRef = useRef(null);

        useEffect(() => {
          const onMove = (e) => {
            mouseRef.current = { x: e.clientX, y: e.clientY };
          };
          window.addEventListener('mousemove', onMove);
          return () => window.removeEventListener('mousemove', onMove);
        }, []);

        useEffect(() => {
          const canvas = canvasRef.current;
          if (!canvas) return;
          const ctx = canvas.getContext('2d');
          let raf;
          const tier = getBeanTier(collectedCount);

          const draw = () => {
            const trail = trailRef.current;
            const mouse = mouseRef.current;
            const lerp = 0.18;
            const tailLerp = 0.12;

            if (trail.length > 0) {
              const last = trail.length - 1;
              trail[last].x += (mouse.x - trail[last].x) * lerp;
              trail[last].y += (mouse.y - trail[last].y) * lerp;
              for (let i = last - 1; i >= 0; i--) {
                trail[i].x += (trail[i + 1].x - trail[i].x) * tailLerp;
                trail[i].y += (trail[i + 1].y - trail[i].y) * tailLerp;
              }
            }

            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            const colors = tier === 'gold' ? [255, 215, 0] : tier === 'purple' ? [176, 38, 255] : [201, 240, 49];
            trail.forEach((p, i) => {
              const t = i / Math.max(1, trail.length);
              const alpha = 0.4 + 0.6 * t;
              const r = 4 + t * 4;
              const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, r * 2);
              gradient.addColorStop(0, `rgba(${colors[0]}, ${colors[1]}, ${colors[2]}, ${alpha})`);
              gradient.addColorStop(0.5, `rgba(${colors[0]}, ${colors[1]}, ${colors[2]}, ${alpha * 0.6})`);
              gradient.addColorStop(1, 'transparent');
              ctx.beginPath();
              ctx.arc(p.x, p.y, r * 2, 0, Math.PI * 2);
              ctx.fillStyle = gradient;
              ctx.fill();
              if (tier === 'gold' && i < trail.length - 1) {
                const p2 = trail[i + 1];
                for (let j = 1; j <= 3; j++) {
                  const k = j / 4;
                  const px = p.x + (p2.x - p.x) * k;
                  const py = p.y + (p2.y - p.y) * k;
                  const pa = (1 - k) * alpha * 0.4;
                  ctx.beginPath();
                  ctx.arc(px, py, r * 0.5, 0, Math.PI * 2);
                  ctx.fillStyle = `rgba(255, 215, 0, ${pa})`;
                  ctx.fill();
                }
              }
            });

            raf = requestAnimationFrame(draw);
          };
          raf = requestAnimationFrame(draw);
          return () => cancelAnimationFrame(raf);
        }, [collectedCount]);

        const handleBeanClick = (id) => {
          const mouse = mouseRef.current;
          const nextCount = collectedCount + 1;

          setBeans(prev => {
            const next = prev.filter(b => b.id !== id);
            next.push(genSingleBean());
            return next;
          });
          setCollectedCount(nextCount);
          trailRef.current.push({ x: mouse.x, y: mouse.y });

          setScoreBump(true);
          setTimeout(() => setScoreBump(false), 300);

          if (nextCount > 0 && nextCount % 50 === 0) {
            setShowLevelUp(true);
            setTimeout(() => setShowLevelUp(false), 1500);
          }
        };

        const tier = getBeanTier(collectedCount);
        const tierClass = `tier-${tier}`;
        const beanSize = tier === 'gold' ? 14 : tier === 'purple' ? 12 : 10;
        const beanOffset = beanSize / 2;

        return (
          <>
            <div className={`score-board ${scoreBump ? 'score-bump' : ''}`}>
              DATA COLLECTED: <span className="score-num">{collectedCount}</span>
            </div>
            {showLevelUp && <div className="level-up-popup">LEVEL UP!</div>}
            <div className="bean-layer">
              {beans.map(b => (
                <div
                  key={b.id}
                  className={`cyber-bean ${tierClass} ${tier === 'green' ? b.color : ''}`}
                  style={{ left: b.x - beanOffset, top: b.y - beanOffset }}
                  onClick={() => handleBeanClick(b.id)}
                />
              ))}
            </div>
            <canvas ref={canvasRef} className="trail-canvas" />
          </>
        );
      }

      function App() {
        const { timeLeft, isReached } = useCountdown();
        useFireworks(isReached);

        return (
          <div className="countdown-container">
            <div className="cyber-bg" />
            <div className="grid-overlay" />
            <BeanGame />
            {isReached ? (
              <FreedomDisplay />
            ) : (
              <div style={{ textAlign: 'center' }}>
                <div className="subtitle">距离放假还有</div>
                <CountdownDisplay timeLeft={timeLeft} />
                <div className="target-hint">目标: 2026年2月13日 12:30:00</div>
              </div>
            )}
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById('root'));
      root.render(<App />);
    })();
  </script>
</body>
</html>
